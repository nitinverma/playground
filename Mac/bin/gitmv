#!/usr/bin/env bash

if [[ ""$GITREPO"" == """" ]]; then
	GITREPO=/Users/nitin/Codes/git/github/pinadoc/pinadoc-refactored
fi

if [[ ""$FROM_BRANCH"" == """" ]]; then
	FROM_BRANCH=master
fi

if [[ ""$FROM_DIR"" == """" ]]; then
	FROM_DIR=algorithms
fi

if [[ ""$TO_BRANCH"" == """" ]]; then
	TO_BRANCH=develop
fi

if [[ ""$TO_DIR"" == """" ]]; then
	TO_DIR=algorithms
fi

BASEDIR=/tmp/.gitwork
rm -rf $BASEDIR
mkdir -p ${BASEDIR}

SUBDIR_REPO=${BASEDIR}/subir
(
	git clone ${GITREPO} ${SUBDIR_REPO}
	cd ${SUBDIR_REPO}
	git checkout ${FROM_BRANCH}
	git remote rm origin
	git filter-branch --subdirectory-filter ${FROM_DIR} -- --all
	FILES=$(git ls-files)
	for FILE in $FILES
	do
		mkdir -p ${TO_DIR}/$(dirname $FILE)
		git mv $FILE ${TO_DIR}/${FILE}
	done
	git add .
	git commit -m"Moving from ${FROM_DIR} to ${TO_DIR}"
)

MERGE_REPO=${BASEDIR}/merge
(
	git clone ${GITREPO} ${MERGE_REPO}
	cd ${MERGE_REPO}
	git checkout ${TO_BRANCH}
	git remote add subdir ${SUBDIR_REPO}
	git pull subdir ${FROM_BRANCH}
	git push origin ${TO_BRANCH}
)

